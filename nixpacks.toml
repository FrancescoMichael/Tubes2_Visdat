# Use Python's built-in urllib to download pip installer
providers = ["node", "python"]

[variables]
NODE_VERSION = "18"
PYTHON_VERSION = "3.11"

[phases.build]
cmds = [
  "cd frontend && npm install && npm run build",
  "cd ..",
  # Use Python to download get-pip.py
  "python3 -c \"import urllib.request; urllib.request.urlretrieve('https://bootstrap.pypa.io/get-pip.py', 'get-pip.py')\"",
  "python3 get-pip.py --user",
  "export PATH=$HOME/.local/bin:$PATH",
  "cd backend && python3 -m pip install -r requirements.txt"
]

[phases.start]
cmd = "export PATH=$HOME/.local/bin:$PATH && cd backend && python3 import_data.py && python3 run.py"

[build]
buildCommand = "cd frontend && npm install && npm run build && cd ../backend && python3 -c \"import urllib.request; urllib.request.urlretrieve('https://bootstrap.pypa.io/get-pip.py', 'get-pip.py')\" && python3 get-pip.py --user && export PATH=$HOME/.local/bin:$PATH && python3 -m pip install -r requirements.txt"

[deploy]
startCommand = "export PATH=$HOME/.local/bin:$PATH && cd backend && python3 import_data.py && python3 run.py"